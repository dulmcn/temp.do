---
title: "LLVM中的LTO"
description: "记录学习LLVM中的LTO的过程！"
author: <author_id>
date: 2024-10-12 17:53:00 +0800
categories: 
tags: [LLVM,LTO]
pin: true
math: true
mermaid: true
---
# LLVM中的LTO（Link-Time Optimization）
## 1、什么是LTO
&emsp;&emsp;链接时优化（Link-Time Optimization, LTO）是链接期间的程序优化。由于编译器一次只编译优化一个编译单元，因此在编译期的很多优化都难以跨编译单元执行，只是在做局部的优化。LTO 就是对整个程序代码进行的一种优化，在链接时将多个中间文件通过链接器合并在一起，进行跨模块间的优化。LTO 聚焦分析整个程序代码，能够大范围地应用过程间优化，从而取得比较好的优化效果，还能够缩减代码体积。
## 2、LTO的使用方式
&emsp;&emsp;llvm中使用LTO的方式如下所示：   
```
  	clang -flto -c a.c -o a.o        # <-- a.o is LLVM bitcode file
  	clang -c main.c -o main.o        # <-- main.o is native object file
  	clang -flto a.o main.o -o main   # <-- standard link command with -flto
```
&emsp;&emsp;在源文件编译时，添加-flto编译选项，这样编译出的.o文件不是目标文件，而是bitcode类型的文件。在链接的时候，lld识别到bitcode类型的输入文件，自动开启LTO。
## 3、LTO的执行流程
&emsp;&emsp;LTO的核心原理是在链接阶段进行全局优化。正常链接与使用LTO的基本流程对比如下：
